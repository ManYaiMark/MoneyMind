{% extends 'expenses/base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">ü§ñ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≠‡∏á AI (Admin Only)</h2>

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    <h4>üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏°‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡πÉ‡∏´‡∏°‡πà (Re-train)</h4>
                    <p class="text-muted">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤ AI ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏±‡πà‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏á Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</p>
                    <form method="post">
                        {% csrf_token %}
                        <button type="submit" name="retrain" class="btn btn-warning w-100 fw-bold">Re-train Model Now</button>
                    </form>
                </div>
            </div>
        </div>

            <div class="col-md-6">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h4 class="mb-0">üìÇ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (Import CSV)</h4>
                            
                            <a href="{% url 'download_ai_template' %}" class="btn btn-sm btn-outline-secondary">
                                ‚¨áÔ∏è ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                            </a>
                        </div>

                        <p class="text-muted small">‡πÑ‡∏ü‡∏•‡πå CSV ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå, ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</p>
                        
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="mb-3">
                                <input type="file" name="csv_file" class="form-control" accept=".csv" required>
                            </div>
                            <button type="submit" name="import_csv" class="btn btn-primary w-100 fw-bold">Upload & Train</button>
                        </form>
                    </div>
                </div>
            </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">üìö ‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h5>
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå (Text)</th>
                        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Category)</th>
                        <th>‡∏™‡∏≠‡∏ô‡πÇ‡∏î‡∏¢</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in training_data %}
                    <tr>
                        <td>{{ item.text }}</td>
                        <td><span class="badge bg-info text-dark">{{ item.category.name }}</span></td>
                        <td>{{ item.user.username|default:"Admin/System" }}</td>
                        <td>
                            {% if item.is_verified %}
                                <span class="text-success">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
                            {% else %}
                                <span class="text-muted">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≠‡∏ô</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}